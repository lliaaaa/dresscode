{% extends "base.html" %}
{% block title %}Admin Dashboard{% endblock %}

{% block content %}
<style>
    /* Print Styles */
    @media print {

        header,
        .logout-btn,
        .clear-btn,
        .show-btn,
        .export-btn,
        .add-student-btn,
        #controls-section,
        #stats-section,
        .btn-small,
        .pagination {
            display: none !important;
        }

        body {
            background: white;
        }

        .admin-table-container {
            box-shadow: none;
            padding: 0;
        }

        .admin-table {
            font-size: 10pt;
        }

        .admin-table th,
        .admin-table td {
            padding: 4px;
        }
    }

    /* Toast Notifications */
    .toast {
        position: fixed;
        bottom: -100px;
        right: 20px;
        padding: 15px 20px;
        border-radius: 4px;
        color: white;
        font-weight: 500;
        z-index: 10000;
        transition: bottom 0.3s ease;
        max-width: 300px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .toast.show {
        bottom: 20px;
    }

    .toast-success {
        background-color: #4CAF50;
    }

    .toast-error {
        background-color: #f44336;
    }

    .toast-info {
        background-color: #2196F3;
    }

    /* Loading Spinner */
    .loading-spinner {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(255, 255, 255, .3);
        border-radius: 50%;
        border-top-color: white;
        animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
        to {
            transform: rotate(360deg);
        }
    }

    .table-loading {
        position: relative;
        opacity: 0.5;
        pointer-events: none;
    }

    .table-loading::after {
        content: 'Loading...';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(255, 255, 255, 0.9);
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        font-weight: bold;
        color: #800000;
    }

    /* Button Styles */
    .btn-small {
        padding: 6px 12px;
        font-size: 12px;
        margin-right: 5px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .btn-primary {
        background-color: #007bff;
        color: white;
    }

    .btn-primary:hover {
        background-color: #0056b3;
        transform: translateY(-2px);
        box-shadow: 0 2px 8px rgba(0, 91, 179, 0.3);
    }

    .btn-danger {
        background-color: #dc3545;
        color: white;
    }

    .btn-danger:hover {
        background-color: #c82333;
        transform: translateY(-2px);
        box-shadow: 0 2px 8px rgba(220, 53, 69, 0.3);
    }

    .btn-small:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
    }

    /* Primary Action Buttons */
    .clear-btn,
    .show-btn,
    .export-btn,
    .add-student-btn {
        padding: 8px 16px;
        margin-right: 10px;
        margin-bottom: 10px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.2s ease;
    }

    .clear-btn {
        background-color: #dc3545;
        color: white;
    }

    .clear-btn:hover {
        background-color: #c82333;
        box-shadow: 0 2px 8px rgba(220, 53, 69, 0.3);
        transform: translateY(-2px);
    }

    .show-btn {
        background-color: #28a745;
        color: white;
    }

    .show-btn:hover {
        background-color: #218838;
        box-shadow: 0 2px 8px rgba(40, 135, 69, 0.3);
        transform: translateY(-2px);
    }

    .export-btn {
        background-color: #17a2b8;
        color: white;
    }

    .export-btn:hover {
        background-color: #138496;
        box-shadow: 0 2px 8px rgba(23, 162, 184, 0.3);
        transform: translateY(-2px);
    }

    .add-student-btn {
        background-color: #007bff;
        color: white;
    }

    .add-student-btn:hover {
        background-color: #0056b3;
        box-shadow: 0 2px 8px rgba(0, 91, 179, 0.3);
        transform: translateY(-2px);
    }

    .logout-btn {
        background-color: #800000;
        color: white;
        padding: 8px 16px;
        margin-right: 10px;
        margin-bottom: 10px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.2s ease;
    }

    .logout-btn:hover {
        background-color: #a52a2a;
        box-shadow: 0 2px 8px rgba(128, 0, 0, 0.3);
        transform: translateY(-2px);
    }

    /* Message Styles */
    .error-message {
        color: #d32f2f;
        font-weight: 500;
        margin-top: 10px;
        padding: 10px;
        background-color: #ffebee;
        border-left: 4px solid #d32f2f;
        border-radius: 2px;
    }

    .success-message {
        color: #388e3c;
        font-weight: 500;
        margin-top: 10px;
        padding: 10px;
        background-color: #e8f5e9;
        border-left: 4px solid #388e3c;
        border-radius: 2px;
    }

    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 40px;
        color: #666;
        font-style: italic;
    }

    .text-center {
        text-align: center;
        color: #666;
        padding: 20px;
    }

    /* Student Photo */
    .student-photo {
        width: 40px;
        height: 40px;
        object-fit: cover;
        border-radius: 4px;
        border: 1px solid #ddd;
    }

    /* Button State */
    button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
    }

    /* Modal Improvements */
    .modal-shadow {
        animation: slideIn 0.3s ease-out;
        display: none;
        position: fixed;
        z-index: 999;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        align-items: center;
        justify-content: center;
    }

    .modal-content {
        background-color: #f9f9f9;
        padding: 20px;
        border: 1px solid #888;
        width: 90%;
        max-width: 800px;
        border-radius: 8px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
    }

    .close-modal-btn {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
        border: none;
        background: none;
        line-height: 1;
    }

    .close-modal-btn:hover,
    .close-modal-btn:focus {
        color: black;
        text-decoration: none;
    }

    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateY(20px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Admin Table Container */
    .admin-table-container {
        padding: 20px;
        background-color: white;
        border-radius: 8px;
    }

    .admin-table-title {
        color: #800000;
        font-size: 24px;
        margin-bottom: 20px;
        border-bottom: 3px solid #800000;
        padding-bottom: 10px;
    }

    .admin-table {
        width: 100%;
        border-collapse: collapse;
    }

    .admin-table thead {
        background-color: #800000;
        color: white;
    }

    .admin-table th {
        padding: 12px;
        text-align: left;
        font-weight: 600;
    }

    .admin-table td {
        padding: 12px;
        border-bottom: 1px solid #e0e0e0;
    }

    .admin-table tbody tr:hover {
        background-color: #f5f5f5;
    }

    .admin-table tbody tr:nth-child(even) {
        background-color: #fafafa;
    }

    /* Student List Actions */
    #studentlist-actions {
        margin-bottom: 15px;
        display: flex;
        gap: 10px;
    }

    .studentlist-title {
        color: #800000;
        font-size: 20px;
        margin-bottom: 15px;
    }

    /* Form Group */
    .form-group {
        margin-bottom: 15px;
    }

    .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: 500;
        color: #333;
    }

    .form-group input,
    .form-group select {
        width: 100%;
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
        box-sizing: border-box;
    }

    .form-group input:focus,
    .form-group select:focus {
        outline: none;
        border-color: #007bff;
        box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.25);
    }

    #studentlist-form {
        background-color: #f9f9f9;
        padding: 20px;
        border-radius: 4px;
    }

    #studentlist-form-title {
        color: #800000;
        margin-bottom: 20px;
    }

    /* Statistics Dashboard */
    #stats-section {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
    }

    .stat-card {
        background: linear-gradient(135deg, #800000 0%, #a52a2a 100%);
        color: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s;
    }

    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .stat-card h3 {
        margin: 0 0 10px 0;
        font-size: 14px;
        opacity: 0.9;
    }

    .stat-card .stat-value {
        font-size: 32px;
        font-weight: bold;
        margin: 0;
    }

    /* Controls Section */
    #controls-section {
        background: #f5f5f5;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
    }

    .control-group {
        margin-bottom: 15px;
    }

    .control-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: 500;
        color: #333;
    }

    .control-row {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        align-items: center;
    }

    .search-box,
    .date-input,
    .filter-select {
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
        flex: 1;
        min-width: 200px;
    }

    .search-box:focus,
    .date-input:focus,
    .filter-select:focus {
        outline: none;
        border-color: #800000;
        box-shadow: 0 0 0 3px rgba(128, 0, 0, 0.1);
    }

    /* Pagination */
    .pagination {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 10px;
        margin-top: 20px;
        flex-wrap: wrap;
    }

    .pagination button {
        padding: 8px 12px;
        border: 1px solid #ddd;
        background: white;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.2s;
    }

    .pagination button:hover:not(:disabled) {
        background: #800000;
        color: white;
        border-color: #800000;
    }

    .pagination button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .pagination button.active {
        background: #800000;
        color: white;
        border-color: #800000;
    }

    .pagination-info {
        color: #666;
        font-size: 14px;
    }

    /* Sortable Headers */
    .sortable {
        cursor: pointer;
        user-select: none;
        position: relative;
        padding-right: 20px !important;
    }

    .sortable:hover {
        background-color: #600000;
    }

    .sortable::after {
        content: '⇅';
        position: absolute;
        right: 8px;
        opacity: 0.5;
    }

    .sortable.sort-asc::after {
        content: '↑';
        opacity: 1;
    }

    .sortable.sort-desc::after {
        content: '↓';
        opacity: 1;
    }

    /* Bulk Actions */
    .bulk-actions {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
        align-items: center;
    }

    .checkbox-cell {
        width: 40px;
        text-align: center;
    }

    .checkbox-cell input[type="checkbox"] {
        cursor: pointer;
        width: 18px;
        height: 18px;
    }

    /* Student Profile Modal */
    #student-profile-modal .profile-header {
        background: linear-gradient(135deg, #800000 0%, #a52a2a 100%);
        color: white;
        padding: 20px;
        border-radius: 8px 8px 0 0;
        margin: -20px -20px 20px -20px;
    }

    #student-profile-modal .profile-photo {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        object-fit: cover;
        border: 4px solid white;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    #student-profile-modal .profile-info {
        margin-left: 20px;
    }

    #student-profile-modal .profile-info h2 {
        margin: 0 0 10px 0;
    }

    #student-profile-modal .profile-info p {
        margin: 5px 0;
        opacity: 0.9;
    }

    .profile-violations {
        margin-top: 20px;
    }

    .profile-violations h3 {
        color: #800000;
        border-bottom: 2px solid #800000;
        padding-bottom: 10px;
        margin-bottom: 15px;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        #stats-section {
            grid-template-columns: 1fr;
        }

        .control-row {
            flex-direction: column;
        }

        .search-box,
        .date-input,
        .filter-select {
            width: 100%;
            min-width: 0;
        }

        .clear-btn,
        .show-btn,
        .export-btn,
        .add-student-btn,
        .logout-btn {
            width: 100%;
            margin-right: 0;
        }

        .admin-table-container {
            padding: 10px;
            overflow-x: auto;
        }

        .admin-table {
            font-size: 12px;
        }

        .admin-table th,
        .admin-table td {
            padding: 8px 4px;
        }

        .btn-small {
            font-size: 10px;
            padding: 4px 8px;
        }

        .pagination {
            font-size: 12px;
        }

        .pagination button {
            padding: 6px 10px;
        }
    }

    @media (max-width: 480px) {
        .admin-table {
            display: block;
            overflow-x: auto;
            white-space: nowrap;
        }

        .modal-content {
            width: 95%;
            padding: 15px;
        }
    }

    /* Hidden class for toggle */
    .hidden {
        display: none !important;
    }

    /* Confirmation Dialog */
    .confirm-dialog {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        z-index: 10001;
        max-width: 400px;
        width: 90%;
    }

    .confirm-dialog h3 {
        margin: 0 0 15px 0;
        color: #800000;
    }

    .confirm-dialog p {
        margin-bottom: 20px;
        color: #666;
    }

    .confirm-dialog-buttons {
        display: flex;
        gap: 10px;
        justify-content: flex-end;
    }

    .confirm-dialog-buttons button {
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
    }

    .confirm-yes {
        background: #dc3545;
        color: white;
    }

    .confirm-no {
        background: #6c757d;
        color: white;
    }

    .confirm-yes:hover {
        background: #c82333;
    }

    .confirm-no:hover {
        background: #5a6268;
    }
</style>
<main>
    <div class="admin-table-container card-effect">
        <h2 class="admin-table-title">Dress Code Violation Record Sheet</h2>

        <!-- ================= STATISTICS ================= -->
        <div id="stats-section">
            <div class="stat-card">
                <h3>Total Violations</h3>
                <p class="stat-value">{{ violations|length }}</p>
            </div>
        </div>

        <!-- ================= ACTION BUTTONS ================= -->
        <div style="margin-bottom: 15px;">
            <a href="{{ url_for('auth.logout') }}" class="logout-btn">Logout</a>
            <button id="show-studentlist-btn" class="show-btn">Show Student List</button>
        </div>

        <!-- ================= VIOLATION TABLE ================= -->
        <table class="admin-table">
            <thead>
                <tr>
                    <th>Student ID</th>
                    <th>Name</th>
                    <th>Course</th>
                    <th>Year</th>
                    <th>Violation</th>
                    <th>Logged By</th>
                    <th>Date</th>
                    <th>Action</th>
                </tr>
            </thead>

            <tbody>
            {% for v in violations %}
                <tr>
                    <td>{{ v.student.student_id }}</td>

                    <td>
                        {{ v.student.first_name }}
                        {{ v.student.last_name }}
                    </td>

                    <td>{{ v.student.program }}</td>

                    <td>{{ v.student.year }}</td>

                    <td>{{ v.violation_type }}</td>

                    <td>{{ v.admin.email }}</td>

                    <td>{{ v.violation_date.strftime('%Y-%m-%d') }}</td>

                    <td>
                        <form method="POST"
                              action="{{ url_for('main.delete_violation', id=v.violation_id) }}">
                            <button class="btn-small btn-danger">Delete</button>
                        </form>
                    </td>
                </tr>
            {% else %}
                <tr>
                    <td colspan="8" class="text-center">No violations found</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- ================= STUDENT LIST MODAL ================= -->
    <div id="studentlist-modal" class="modal-shadow">
        <div class="modal-content">
            <button id="close-studentlist-modal" class="close-modal-btn">&times;</button>

            <h3 class="studentlist-title">Student List</h3>

            <table class="admin-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Course</th>
                        <th>Year</th>
                    </tr>
                </thead>

                <tbody>
                {% for student in students %}
                    <tr>
                        <td>{{ student.student_id }}</td>
                        <td>
                            {{ student.first_name }}
                            {{ student.last_name }}
                        </td>
                        <td>{{ student.program }}</td>
                        <td>{{ student.year }}</td>
                    </tr>
                {% else %}
                    <tr>
                        <td colspan="4" class="text-center">No students found</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</main>

<!-- ================= MODAL SCRIPT ================= -->
<script>
document.addEventListener('DOMContentLoaded', () => {
    const studentListModal = document.getElementById('studentlist-modal');
    const showBtn = document.getElementById('show-studentlist-btn');
    const closeBtn = document.getElementById('close-studentlist-modal');

    showBtn.onclick = () => studentListModal.style.display = 'flex';
    closeBtn.onclick = () => studentListModal.style.display = 'none';

    studentListModal.addEventListener('click', e => {
        if (e.target === studentListModal) {
            studentListModal.style.display = 'none';
        }
    });
});
</script>

{% endblock %}
